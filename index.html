<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Image Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e5e5e5; }
        .nexus-card { background: #171717; border: 1px solid #262626; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        .nexus-input { background: #0a0a0a; border: 1px solid #404040; transition: all 0.3s; }
        .nexus-input:focus { border-color: #10b981; outline: none; }
        .nexus-input.augmenting { border-color: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
        .nexus-btn { background: #10b981; transition: transform 0.1s, background-color 0.2s; }
        .nexus-btn:hover { background: #059669; }
        .nexus-btn:active { transform: scale(0.98); }
        .image-container { min-height: 400px; max-height: 70vh; border: 2px dashed #262626; position: relative; transition: aspect-ratio 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .loader { border-top-color: #10b981; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .token-tag { background: #065f46; color: #34d399; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        optgroup { background: #171717; color: #10b981; font-weight: bold; font-family: monospace; text-transform: uppercase; letter-spacing: 1px; }
        option { background: #0a0a0a; color: #e5e5e5; font-weight: normal; }
        
        .action-btn { 
            background: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(8px); 
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }
        .action-btn:hover { background: rgba(16, 185, 129, 0.6); border-color: #10b981; transform: translateY(-2px); }
        .action-btn:active { transform: translateY(0); }
        
        #copyToast {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: 20px;
            right: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .enhance-btn {
            background: #171717;
            border: 1px solid #404040;
            color: #a3a3a3;
            transition: all 0.2s;
        }
        .enhance-btn:hover:not(:disabled) { border-color: #10b981; color: #10b981; }
        .enhance-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .enhance-btn.active { border-color: #10b981; color: #10b981; background: rgba(16, 185, 129, 0.1); }
        
        #promptHint {
            display: none;
            position: absolute;
            bottom: 50px;
            right: 0;
            background: #171717;
            border: 1px solid #404040;
            padding: 16px;
            border-radius: 12px;
            width: 320px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.7);
            z-index: 50;
        }

        /* Filmstrip Styling */
        .filmstrip {
            scrollbar-width: thin;
            scrollbar-color: #262626 #0a0a0a;
        }
        .filmstrip::-webkit-scrollbar { height: 6px; }
        .filmstrip::-webkit-scrollbar-track { background: #0a0a0a; }
        .filmstrip::-webkit-scrollbar-thumb { background: #262626; border-radius: 10px; }
        .history-item { 
            flex: 0 0 120px;
            height: 120px;
            border: 2px solid #262626;
            transition: all 0.2s;
            cursor: pointer;
            overflow: hidden;
            background: #000;
            position: relative;
        }
        .history-item:hover { border-color: #10b981; transform: scale(1.05); z-index: 10; }
        .history-item img { width: 100%; height: 100%; object-fit: cover; }
        
        .delete-entry-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: #666;
            border-radius: 4px;
            padding: 4px;
            opacity: 0;
            transition: all 0.2s;
        }
        .history-item:hover .delete-entry-btn { opacity: 1; }
        .delete-entry-btn:hover { color: #ef4444; background: rgba(0, 0, 0, 0.9); }

        .ascii-banner {
            font-family: monospace;
            line-height: 1.1;
            color: #10b981;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
            font-size: 8px; /* Standard size for desktop */
            user-select: none;
        }
        @media (max-width: 640px) {
            .ascii-banner { font-size: 4.5px; }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 lg:p-12">

    <div id="copyToast" class="font-mono uppercase tracking-widest text-xs">Vision Copied to Buffer</div>

    <!-- Raw ASCII Header -->
    <div class="mb-8 text-center space-y-4">
        <pre class="ascii-banner inline-block text-left">
    _/      _/                                                      _/    _/      _/      _/  _/            _/                     
   _/_/    _/    _/_/    _/    _/  _/    _/    _/_/_/            _/    _/        _/      _/        _/_/_/        _/_/    _/_/_/    
  _/  _/  _/  _/_/_/_/    _/_/    _/    _/  _/_/              _/    _/          _/      _/  _/  _/_/      _/  _/    _/  _/    _/   
 _/    _/_/  _/        _/    _/  _/    _/      _/_/        _/    _/              _/  _/    _/      _/_/  _/  _/    _/  _/    _/    
_/      _/    _/_/_/  _/    _/    _/_/_/  _/_/_/        _/    _/                  _/      _/  _/_/_/    _/    _/_/    _/    _/ 
        </pre>
        <p class="text-neutral-500 font-mono text-[10px] tracking-[0.4em] uppercase text-center w-full">[ Sovereign Visual synthesis ]</p>
    </div>

    <div class="w-full max-w-5xl nexus-card rounded-2xl p-8 lg:p-12 mb-8">
        
        <!-- Stats Unified -->
        <div class="mb-10 text-center">
            <div class="inline-flex items-center justify-center bg-neutral-900 border border-neutral-800 rounded-xl px-2 py-3 divide-x divide-neutral-800 shadow-inner text-center">
                <div class="px-6 text-center">
                    <p class="text-[9px] text-neutral-500 uppercase tracking-widest font-bold mb-1">Pollen Wallet</p>
                    <p id="pollenCount" class="text-lg font-mono text-emerald-400">---</p>
                </div>
                <div class="px-6 text-center">
                    <p class="text-[9px] text-neutral-500 uppercase tracking-widest font-bold mb-1">Synthesis Cost</p>
                    <p id="modelCost" class="text-lg font-mono text-emerald-500">0.0000</p>
                </div>
                <div class="px-6 text-center">
                    <p class="text-[9px] text-neutral-500 uppercase tracking-widest font-bold mb-1">Remaining</p>
                    <p id="remGens" class="text-lg font-mono text-emerald-400">0</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
            <!-- Controls Column -->
            <div class="space-y-6">
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-xs font-bold text-neutral-500 uppercase tracking-widest">Model Engine</label>
                            <span id="priceMode" class="hidden token-tag uppercase">Token-Based</span>
                        </div>
                        <select id="modelSelect" onchange="updateModelPrice()" class="w-full nexus-input rounded-lg p-3 text-white text-sm">
                            <option value="">Loading Models...</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold mb-2 text-neutral-500 uppercase tracking-widest">Aspect Ratio</label>
                            <select id="aspectRatio" onchange="updateLayoutRatio()" class="w-full nexus-input rounded-lg p-3 text-white text-sm">
                                <option value="1024x1024">Square (1:1)</option>
                                <option value="1280x720">Wide (16:9)</option>
                                <option value="720x1280">Tall (9:16)</option>
                                <option value="1024x768">Classic (4:3)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold mb-2 text-neutral-500 uppercase tracking-widest">Fixed Seed</label>
                            <input id="seedInput" type="number" class="w-full nexus-input rounded-lg p-3 text-white text-sm" placeholder="Random (-1)" value="-1">
                        </div>
                    </div>

                    <div class="relative">
                        <label class="block text-xs font-bold mb-2 text-neutral-500 uppercase tracking-widest">Positive Prompt</label>
                        <textarea id="promptInput" rows="4" class="w-full nexus-input rounded-lg p-3 text-white placeholder-neutral-700 text-sm" placeholder="Describe the vision..."></textarea>
                        
                        <!-- Enhancement Toolbar -->
                        <div class="flex justify-end mt-2 items-center space-x-2 relative">
                            <div id="promptHint" class="text-left shadow-2xl">
                                <p class="text-[10px] font-bold text-emerald-500 uppercase mb-2 tracking-widest">Synthesis Engine Logic</p>
                                <p id="systemPromptText" class="text-[11px] text-neutral-400 font-mono leading-relaxed bg-black/30 p-3 rounded-lg border border-neutral-800 italic"></p>
                            </div>
                            
                            <button id="hintBtn" onclick="toggleHint()" class="enhance-btn p-2 rounded-lg" title="View Enhancement Prompt">
                                <i data-lucide="help-circle" class="w-4 h-4"></i>
                            </button>
                            <button id="enhanceBtn" onclick="enhancePrompt()" class="enhance-btn px-4 py-2 rounded-lg flex items-center space-x-2 font-mono text-[10px] uppercase font-bold">
                                <i id="enhanceIcon" data-lucide="sparkles" class="w-3 h-3"></i>
                                <span id="enhanceText">Enhance Vision</span>
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold mb-2 text-neutral-500 uppercase tracking-widest">Negative Prompt (Exclude)</label>
                        <input id="negativeInput" type="text" class="w-full nexus-input rounded-lg p-3 text-white placeholder-neutral-700 text-sm" placeholder="blurry, distorted, text...">
                    </div>

                    <button onclick="generateImage()" id="genBtn" class="w-full nexus-btn text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center space-x-2 uppercase tracking-widest mt-4">
                        <span>Engage Synthesis</span>
                    </button>
                </div>
            </div>

            <!-- Result Column -->
            <div id="resultArea" style="aspect-ratio: 1/1;" class="image-container rounded-xl overflow-hidden flex items-center justify-center bg-black shadow-inner border border-neutral-800 group mx-auto w-full">
                <div id="loadingOverlay" class="hidden absolute inset-0 bg-black/80 flex flex-col items-center justify-center space-y-4 z-10">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                    <p id="loadingMsg" class="text-emerald-400 font-mono text-sm animate-pulse uppercase tracking-widest text-center px-4">Modulating Neural Lattice...</p>
                </div>
                
                <img id="outputImage" class="max-w-full max-h-full object-contain hidden" src="" alt="Generated artwork" crossorigin="anonymous">
                
                <!-- Floating Actions -->
                <div id="floatingActions" class="hidden absolute bottom-4 right-4 flex space-x-2 z-20 group-hover:flex">
                    <button onclick="copyToClipboard()" class="action-btn p-3 rounded-lg text-white" title="Copy to Clipboard">
                        <i data-lucide="copy" class="w-5 h-5"></i>
                    </button>
                    <button onclick="downloadImage()" class="action-btn p-3 rounded-lg text-white" title="Download Image">
                        <i data-lucide="download" class="w-5 h-5"></i>
                    </button>
                    <button onclick="toggleFullscreen()" class="action-btn p-3 rounded-lg text-white" title="Fullscreen">
                        <i data-lucide="maximize" class="w-5 h-5"></i>
                    </button>
                </div>

                <div id="placeholderText" class="text-neutral-700 text-center p-8 font-mono text-xs max-w-xs uppercase leading-loose text-emerald-900/50">
                    [ Waiting for parameters to be injected into the stream ]
                </div>
            </div>
        </div>
    </div>

    <!-- Filmstrip History -->
    <div class="w-full max-w-5xl overflow-visible">
        <div class="flex items-center justify-between mb-3 px-2">
            <div class="flex items-center space-x-2">
                <p class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Temporal Archive</p>
                <span id="historyCount" class="text-[10px] bg-neutral-800 text-neutral-400 px-2 py-0.5 rounded-full">0</span>
            </div>
            <button onclick="clearHistory()" class="text-[9px] text-neutral-600 hover:text-red-500 uppercase font-bold tracking-tighter">Wipe Archive</button>
        </div>
        <div id="filmstrip" class="filmstrip flex space-x-4 overflow-x-auto pb-6 pt-4 px-4 min-h-[160px]">
            <!-- Items injected here -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 mb-12 text-neutral-600 font-mono text-[10px] uppercase tracking-[0.2em]">
        Powered by <a href="https://pollinations.ai" target="_blank" class="hover:text-emerald-500 transition-colors">Pollinations.ai</a>
    </footer>

    <script>
        let modelCache = [];
        let currentBalance = 0;
        let generationHistory = JSON.parse(localStorage.getItem('nexus_history') || '[]');
        
        const PAID_MODELS = ['seedream-pro', 'gptimage-large', 'nanobanana-pro'];
        const ENHANCEMENT_SYSTEM_PROMPT = "You are an expert prompt engineer for Flux and Stable Diffusion. Expand the users input into a single, cohesive, vivid, and detailed artistic prompt. Focus on lighting, textures, and composition. Be descriptive but stay focused on the users core subject. Output ONLY the improved prompt text. No preamble, no quotes.";

        function formatBalance(val) {
            return Number(val).toLocaleString(undefined, { minimumFractionDigits: 4, maximumFractionDigits: 4 });
        }

        async function fetchMetadata() {
            const select = document.getElementById('modelSelect');
            const pollen = document.getElementById('pollenCount');
            const hintText = document.getElementById('systemPromptText');
            hintText.textContent = ENHANCEMENT_SYSTEM_PROMPT;

            try {
                const bRes = await fetch('https://image.1984.ie/balance');
                const bData = await bRes.json();
                currentBalance = bData.balance;
                pollen.textContent = formatBalance(currentBalance);
            } catch (err) { pollen.textContent = "ERR"; }

            try {
                const mRes = await fetch('https://image.1984.ie/models');
                const rawModels = await mRes.json();
                const getCost = (m) => (m.pricing && m.pricing.completionImageTokens) ? parseFloat(m.pricing.completionImageTokens) : 0;
                const allImageModels = rawModels.filter(m => m.output_modalities && m.output_modalities.includes('image'));
                modelCache = allImageModels;

                const paid = allImageModels.filter(m => PAID_MODELS.includes(m.name)).sort((a, b) => getCost(a) - getCost(b));
                const token = allImageModels.filter(m => !PAID_MODELS.includes(m.name) && m.pricing && m.pricing.promptTextTokens > 0).sort((a, b) => getCost(a) - getCost(b));
                const standard = allImageModels.filter(m => !PAID_MODELS.includes(m.name) && (!m.pricing || !m.pricing.promptTextTokens)).sort((a, b) => getCost(a) - getCost(b));

                select.innerHTML = '';
                const createGroup = (label, list) => {
                    if (list.length === 0) return;
                    const group = document.createElement('optgroup');
                    group.label = label;
                    list.forEach(model => {
                        const opt = document.createElement('option');
                        opt.value = model.name;
                        const cost = getCost(model);
                        const isToken = model.pricing && model.pricing.promptTextTokens > 0;
                        let displayName = (model.description ? model.description.split(' - ')[0] : model.name).toUpperCase();
                        opt.textContent = `${displayName} [${cost.toFixed(4)}${isToken ? '+' : ''}]`;
                        if (model.name === 'flux') opt.selected = true;
                        group.appendChild(opt);
                    });
                    select.appendChild(group);
                };

                createGroup('Pollen / Image', standard);
                createGroup('Pollen / Token', token);
                createGroup('Paid / Premium', paid);
                updateModelPrice();
                lucide.createIcons();
                renderHistory();
            } catch (err) {
                select.innerHTML = '<option value="flux">FLUX SCHNELL</option>';
            }
        }

        function updateModelPrice() {
            const select = document.getElementById('modelSelect');
            const priceEl = document.getElementById('modelCost');
            const remGens = document.getElementById('remGens');
            const modeEl = document.getElementById('priceMode');
            const selected = modelCache.find(m => m.name === select.value);
            
            if (selected && selected.pricing) {
                const cost = parseFloat(selected.pricing.completionImageTokens) || 0;
                const isTokenBased = selected.pricing.promptTextTokens > 0;
                priceEl.textContent = cost.toFixed(4) + (isTokenBased ? "+" : "");
                if (cost > 0) remGens.textContent = Math.floor(currentBalance / cost).toLocaleString();
                else remGens.textContent = "âˆž";
                isTokenBased ? modeEl.classList.remove('hidden') : modeEl.classList.add('hidden');
            }
        }

        function updateLayoutRatio() {
            const ratio = document.getElementById('aspectRatio').value;
            const resArea = document.getElementById('resultArea');
            const dims = ratio.split('x');
            resArea.style.aspectRatio = `${dims[0]} / ${dims[1]}`;
        }

        async function updateBalanceOnly() {
            const pollen = document.getElementById('pollenCount');
            try {
                const bRes = await fetch('https://image.1984.ie/balance');
                const bData = await bRes.json();
                currentBalance = bData.balance;
                pollen.textContent = formatBalance(currentBalance);
                updateModelPrice();
            } catch (err) {}
        }

        function toggleHint() {
            const menu = document.getElementById('promptHint');
            const btn = document.getElementById('hintBtn');
            const isOpen = menu.style.display === 'block';
            menu.style.display = isOpen ? 'none' : 'block';
            isOpen ? btn.classList.remove('active') : btn.classList.add('active');
        }

        async function enhancePrompt() {
            const input = document.getElementById('promptInput');
            const btn = document.getElementById('enhanceBtn');
            const text = document.getElementById('enhanceText');
            const icon = document.getElementById('enhanceIcon');
            if (!input.value) return;
            btn.disabled = true;
            input.classList.add('augmenting');
            const originalText = text.textContent;
            text.textContent = "Augmenting...";
            icon.classList.add('animate-spin');
            try {
                const response = await fetch('https://image.1984.ie/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "grok",
                        messages: [
                            { role: 'system', content: ENHANCEMENT_SYSTEM_PROMPT },
                            { role: 'user', content: input.value }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                let enhancedText = "";
                if (data.choices && data.choices[0].message) {
                    const msg = data.choices[0].message;
                    if (msg.content) enhancedText = msg.content;
                    else if (msg.content_blocks) enhancedText = msg.content_blocks.filter(b => b.type === 'text').map(b => b.text).join('\n');
                }
                if (enhancedText) {
                    input.value = enhancedText.trim();
                    setTimeout(updateBalanceOnly, 1500);
                }
            } catch (err) { alert("Enhancement Failed."); } finally {
                btn.disabled = false;
                input.classList.remove('augmenting');
                text.textContent = originalText;
                icon.classList.remove('animate-spin');
            }
        }

        function generateImage() {
            const model = document.getElementById('modelSelect').value;
            const promptVal = document.getElementById('promptInput').value;
            const negPrompt = document.getElementById('negativeInput').value;
            const ratio = document.getElementById('aspectRatio').value;
            const seedInput = document.getElementById('seedInput').value;
            const img = document.getElementById('outputImage');
            const overlay = document.getElementById('loadingOverlay');
            const placeholder = document.getElementById('placeholderText');
            const btn = document.getElementById('genBtn');
            const actions = document.getElementById('floatingActions');

            if (!promptVal) return;
            overlay.classList.remove('hidden');
            img.classList.add('hidden');
            placeholder.classList.add('hidden');
            actions.classList.add('hidden');
            btn.disabled = true;
            btn.style.opacity = '0.5';

            const dims = ratio.split('x');
            const width = dims[0];
            const height = dims[1];
            const seed = seedInput === "-1" ? Math.floor(Math.random() * 1000000000) : seedInput;
            const url = `https://image.1984.ie/${encodeURIComponent(promptVal)}?model=${model}&seed=${seed}&width=${width}&height=${height}&negative_prompt=${encodeURIComponent(negPrompt)}`;

            const tempImg = new Image();
            tempImg.crossOrigin = "anonymous";
            tempImg.onload = function() {
                img.src = url;
                img.classList.remove('hidden');
                overlay.classList.add('hidden');
                actions.classList.remove('hidden');
                btn.disabled = false;
                btn.style.opacity = '1';
                saveToHistory({ url, model, prompt: promptVal, negative: negPrompt, ratio, seed });
                setTimeout(updateBalanceOnly, 2000);
            };
            tempImg.onerror = function() {
                alert("Synthesis Failure.");
                overlay.classList.add('hidden');
                placeholder.classList.remove('hidden');
                btn.disabled = false;
                btn.style.opacity = '1';
            };
            tempImg.src = url;
        }

        function saveToHistory(item) {
            generationHistory.unshift(item);
            if (generationHistory.length > 50) generationHistory.pop();
            localStorage.setItem('nexus_history', JSON.stringify(generationHistory));
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('filmstrip');
            const countEl = document.getElementById('historyCount');
            container.innerHTML = '';
            countEl.textContent = generationHistory.length;
            generationHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item rounded-lg shadow-lg border-2 border-neutral-800 shrink-0';
                const thumb = document.createElement('img');
                thumb.src = item.url;
                thumb.loading = "lazy";
                thumb.onclick = () => restoreFromHistory(index);
                const delBtn = document.createElement('button');
                delBtn.className = 'delete-entry-btn';
                delBtn.innerHTML = '<i data-lucide="x" class="w-3 h-3"></i>';
                delBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteFromHistory(index);
                };
                div.appendChild(thumb);
                div.appendChild(delBtn);
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        function restoreFromHistory(index) {
            const item = generationHistory[index];
            document.getElementById('modelSelect').value = item.model;
            document.getElementById('promptInput').value = item.prompt;
            document.getElementById('negativeInput').value = item.negative || '';
            document.getElementById('aspectRatio').value = item.ratio;
            document.getElementById('seedInput').value = item.seed;
            
            // Trigger UI updates
            updateLayoutRatio();
            updateModelPrice();
            
            document.getElementById('outputImage').src = item.url;
            document.getElementById('outputImage').classList.remove('hidden');
            document.getElementById('placeholderText').classList.add('hidden');
            document.getElementById('floatingActions').classList.remove('hidden');
        }

        function deleteFromHistory(index) {
            generationHistory.splice(index, 1);
            localStorage.setItem('nexus_history', JSON.stringify(generationHistory));
            renderHistory();
        }

        function clearHistory() {
            if (confirm("Wipe all temporal records?")) {
                generationHistory = [];
                localStorage.removeItem('nexus_history');
                renderHistory();
            }
        }

        function toggleFullscreen() {
            const img = document.getElementById('outputImage');
            if (img.requestFullscreen) img.requestFullscreen();
            else if (img.webkitRequestFullscreen) img.webkitRequestFullscreen();
        }

        async function copyToClipboard() {
            const img = document.getElementById('outputImage');
            const toast = document.getElementById('copyToast');
            try {
                const response = await fetch(img.src);
                const blob = await response.blob();
                const item = new ClipboardItem({ [blob.type]: blob });
                await navigator.clipboard.write([item]);
                toast.style.opacity = '1';
                setTimeout(() => toast.style.opacity = '0', 2000);
            } catch (err) { alert("Direct copy failed. Use Download instead."); }
        }

        function downloadImage() {
            const img = document.getElementById('outputImage');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = `nexus-vision-${Date.now()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        fetchMetadata();
    </script>
</body>
</html>